---
layout: post
title: 【读书笔记】《程序员的自我修养：链接、装载与库》
tags: [note, programming]
---

# 目录

1. [简介](#introduction)
2. [静态链接](#static_linking)
3. [装载与动态链接](#dynamic_linking)
4. [库与运行库](#runtime_library)
5. [索引](#index)

<h1 id="introduction"> 第1部分 简介 </h1>

## 1.1 计算机系统

### 硬件部分

- 对于系统程序开发者来说，计算机多如牛毛的硬件设备中，有三个部件最为关键，它们分别是**中央处理器CPU、内存和I/O控制芯片**
- 北桥连接所有高速芯片，南桥连接所有低速芯片
- 北桥采用过的总线结构有PCI、AGP或PCI Express等
- 除非想把CPU的每一滴油水都榨干，否则可以把多核处理器和对称多处理器(SMP)看成同一个概念

### 软件部分

#### 系统软件

- P.8 “计算机科学领域的任何问题都可以通过增加一个间接的中间层来解决”
- 每个层次之间都需要相互通信，既然需要通信就必须有一个通信的协议，我们一般将其称为**接口**（Interface）
- **应用程序编程接口**（Application Programming Interface）
- 运行库使用操作系统提供的**系统调用接口**（System Call Interface）
  - 系统调用接口在实现中往往以**软件中断**（Software Interrupt）的方式提供

#### 操作系统

- 充分挖掘CPU潜力
  - 早期：**多道程序**的方法--监控程序监控CPU资源
  - 协作的模式：**分时系统**
  - 现代：**多任务系统**--所有应用程序都以**进程**的方式运行在比操作系统权限更低的级别，CPU分配方式为**抢占式**（Preemptive）
- I/O设备
  - 硬件管理交给**硬件驱动程序**（Device Driver）来完成
  - UNIX系统中，硬件设备的访问形式跟访问普通的文件形式一样
  - Windows系统中，图形硬件被抽象成了GDI，声音和多媒体设备被抽象成了DirectX对象，磁盘被抽象成了普通文件系统
  - 文件系统：硬盘基本存储单位为**扇区**（Sector），向硬盘发送I/O命令的方式有很多种，其中最为常见的一种就是通过读写I/O端口寄存器来实现
- 内存
  - 在早期的计算机中，程序是直接运行在物理内存上的。在将有限的物理内存分配给多个程序使用时，会带来三个问题：1. 地址空间不隔离 2. 内存使用效率低 3. 程序运行的地址不确定（涉及重定位的问题）
  - 解决问题的思路是增加中间层：将程序给出的地址看作是**虚拟地址**（Virtual Address），然后映射到物理地址
  - **分段**（Segmentation）：采用段映射机制，将程序所需的虚拟内存空间整段映射到物理内存空间
  - **分页**（Paging）：分页的基本方法是把地址空间人为地等分成固定大小的页，目前几乎所有PC上的操作系统都使用4KB大小的页
    - **虚拟页**（VP, Virtual Page），**物理页**（PP, Physical Page），**磁盘页**（DP, Disk Page）
    - 可以通过内存共享机制解决内存使用效率低的问题
    - 保护也是页映射的目的之一，简单地说就是每个页可以设置权限属性，只有操作系统有权限修改这些属性
    - 虚拟存储的实现需要依靠硬件的支持，几乎所有CPU都采用MMU(Memory Management Unit)将虚拟地址转换成物理地址

#### 多线程

- 线程的概念
  - 线程是程序执行的最小单元
  - 一个标准的线程由线程ID、当前指令指针（PC）、寄存器集合和堆栈组成
  - 各个线程之间共享程序的内存空间（包括代码段、数据段、堆等）及一些进程级的资源（如打开文件和信号）
- 线程的访问权限
  - 线程的私有存储空间包括以下几个方面
    - 栈（尽管并非完全无法被其他线程访问，但一般情况下仍然可以认为是私有的数据）
    - 线程局部存储（Thread Local Storage）
    - 寄存器（包括PC寄存器）
  - 从C程序员的角度来看，数据在线程之间是否私有如表1-1所示
  ![Thread_Specific_Data](/public/img/linkers/Thread_Specific_Data.jpg)
- 线程调度与优先级
  - 不断在处理器上切换不同的线程的行为称之为**线程调度**（Thread Schedule）
  - 在线程调度中，线程通常至少有三种状态：运行、就绪、等待

<h1 id="static_linking"> 第2部分 静态链接 </h1>

<h1 id="dynamic_linking"> 第3部分 装载与动态链接 </h1>

<h1 id="runtime_library"> 第4部分 库与运行库 </h1>

<h1 id="index"> 指令索引 </h1>
